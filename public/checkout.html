<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Código Passional — Checkout Seguro</title>

  <!-- Meta Pixel -->
  <script>
    !function (f, b, e, v, n, t, s) {
      if (f.fbq) return; n = f.fbq = function () {
        n.callMethod ?
          n.callMethod.apply(n, arguments) : n.queue.push(arguments)
      }; if (!f._fbq) f._fbq = n;
      n.push = n; n.loaded = !0; n.version = '2.0'; n.queue = []; t = b.createElement(e); t.async = !0;
      t.src = v; s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s)
    }(window,
      document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');

    // Substitua pelo seu ID se necessário, mas já puxa do .env no servidor
    fbq('init', '27522785837335197');
    fbq('track', 'PageView');
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Reset & Clean Base */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-color: #f9fafb;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-color: #e5e7eb;
      --primary-color: #dc2626;
      /* Vermelho do mockup */
      --primary-hover: #b91c1c;
      --radius: 8px;
      --font-family: 'Inter', sans-serif;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--bg-color);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 20px 10px;
      min-height: 100vh;
    }

    /* Container Principal */
    .checkout-container {
      width: 100%;
      max-width: 500px;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    /* Top Bar (País) */
    .top-bar {
      border-bottom: 1px solid var(--border-color);
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      gap: 6px;
      background: #fff;
    }

    /* Produto Header */
    .product-header {
      padding: 20px;
      display: flex;
      gap: 15px;
      border-bottom: 1px solid var(--border-color);
      align-items: start;
    }

    .product-img {
      width: 70px;
      height: 70px;
      border-radius: 6px;
      object-fit: cover;
      background: #f3f4f6;
      /* Placeholder color */
      flex-shrink: 0;
    }

    .product-info h1 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
    }

    .product-price {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 6px;
    }

    .product-desc {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    /* Formulário */
    .form-section {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-col {
      flex: 1;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      color: var(--text-main);
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
    }

    input:focus,
    select:focus {
      border-color: var(--text-muted);
      /* Cinza um pouco mais escuro ao focar */
    }

    input::placeholder {
      color: #9ca3af;
    }

    /* Celular com bandeira */
    .phone-input-wrapper {
      position: relative;
    }

    .phone-flag {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 14px;
      color: var(--text-main);
      pointer-events: none;
    }

    .phone-input-wrapper input {
      padding-left: 70px;
      /* Espaço para bandeira + +55 */
    }

    /* Tabs de Pagamento */
    .payment-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      border: 1px solid var(--border-color);
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      background: #f9fafb;
    }

    .tab-btn.active {
      border-color: var(--text-main);
      background: #fff;
      box-shadow: 0 0 0 1px var(--text-main);
      /* Borda dupla simulada */
    }

    /* Ícones SVG simples para as tabs */
    .icon-card,
    .icon-pix {
      width: 16px;
      height: 16px;
      display: block;
      fill: currentColor;
    }

    /* Resumo */
    .summary-section {
      border-top: 1px solid var(--border-color);
      padding: 20px;
      background: #fff;
      /* Fundo levemente off-white se quiser, mockup parece branco */
    }

    .summary-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .summary-row.total {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-main);
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed var(--border-color);
    }

    /* Botão */
    .btn-submit {
      width: 100%;
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 14px;
      border-radius: 6px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 16px;
      transition: background 0.2s;
    }

    .btn-submit:hover {
      background: var(--primary-hover);
    }

    .btn-submit:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /* Footer */
    .secure-footer {
      text-align: center;
      margin-top: 16px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .secure-icon {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
      color: var(--text-main);
    }

    .legal-text {
      max-width: 90%;
      text-align: center;
      font-size: 10px;
      color: #9ca3af;
      margin-top: 12px;
      line-height: 1.4;
    }

    /* Utilitários */
    .hidden {
      display: none;
    }

    .error-msg {
      color: #ef4444;
      font-size: 12px;
      margin-top: 4px;
      display: none;
    }

    input.invalid {
      border-color: #ef4444;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/imask"></script>
</head>

<body>

  <div class="checkout-container">

    <!-- Top Bar -->
    <div class="top-bar">
      <!-- Bandeira Brasil SVG -->
      <svg width="16" height="12" viewBox="0 0 640 480">
        <path fill="#009c3b" d="M0 0h640v480H0z" />
        <path fill="#ffdf00" d="M320 23.36l301.6 216.64L320 456.64 18.4 240z" />
        <circle cx="320" cy="240" r="109.52" fill="#002776" />
        <path fill="#fff"
          d="M197.6 280c4.32-61.92 78.88-91.84 153.92-91.84 41.28 0 79.52 9.12 108.64 24.32-3.04 7.2-22.56 50.88-22.56 50.88-29.28-11.84-63.52-19.04-99.36-19.04-58.56 0-109.6 19.36-128.48 35.68z" />
      </svg>
      Brasil
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 9l6 6 6-6" />
      </svg>
    </div>

    <!-- Produto -->
    <div class="product-header">
      <!-- Imagem do produto: supondo que você coloque na pasta public -->
      <img src="/image_mockup_produto.png" alt="Código Passional" class="product-img"
        onerror="this.src='https://placehold.co/70x70?text=Produto'">
      <div class="product-info">
        <h1>Código Passional</h1>
        <div class="product-price">R$ 0,01</div>
        <p class="product-desc">Guia completo com técnicas de reconstrução de relacionamento.</p>
      </div>
    </div>

    <form id="checkoutForm" class="form-section">

      <!-- Dados Pessoais -->
      <div class="form-group">
        <label>Seu e-mail</label>
        <input type="email" id="email" placeholder="Insira seu e-mail" required>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>CPF/CNPJ</label>
          <input type="text" id="cpf" placeholder="Insira seu CPF ou CNPJ" required>
        </div>
        <div class="form-col">
          <label>Seu celular</label>
          <div class="phone-input-wrapper">
            <div class="phone-flag">
              <svg width="16" height="12" viewBox="0 0 640 480">
                <path fill="#009c3b" d="M0 0h640v480H0z" />
                <path fill="#ffdf00" d="M320 23.36l301.6 216.64L320 456.64 18.4 240z" />
                <circle cx="320" cy="240" r="109.52" fill="#002776" />
                <path fill="#fff"
                  d="M197.6 280c4.32-61.92 78.88-91.84 153.92-91.84 41.28 0 79.52 9.12 108.64 24.32-3.04 7.2-22.56 50.88-22.56 50.88-29.28-11.84-63.52-19.04-99.36-19.04-58.56 0-109.6 19.36-128.48 35.68z" />
              </svg>
              <span>+55</span>
            </div>
            <input type="tel" id="phone" placeholder="(DDD) 90000-0000" required>
          </div>
        </div>
      </div>

      <!-- Abas de Pagamento -->
      <label style="margin-top:20px;">Forma de pagamento</label>
      <div class="payment-tabs">
        <div class="tab-btn active" onclick="setTab('card')">
          <svg class="icon-card" viewBox="0 0 24 24">
            <path
              d="M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H3V12h18v6zM3 8V6h18v2H3z" />
          </svg>
          Cartão de crédito
        </div>
        <div class="tab-btn" onclick="setTab('pix')">
          <img src="/pix-svgrepo-com.svg" width="16" height="16" alt="Pix" style="display:block;">
          Pix
        </div>
      </div>

      <!-- Form Cartão -->
      <div id="cardSection">
        <div class="form-group">
          <label>Número do cartão</label>
          <input type="text" id="cardNumber" placeholder="0000 0000 0000 0000">
        </div>
        <div class="form-row">
          <div class="form-col">
            <label>Validade</label>
            <input type="text" id="cardExpiry" placeholder="MM/AA">
          </div>
          <div class="form-col">
            <label>CVV</label>
            <input type="text" id="cardCvv" placeholder="3 ou 4 dígitos">
          </div>
          <div class="form-col" style="flex:1.5;">
            <label>Parcelas</label>
            <select id="installments">
              <option value="1">1x de R$ 0,01</option>
            </select>
          </div>
        </div>
        <div class="form-group" style="margin-top:16px;">
          <label>Nome do titular</label>
          <input type="text" id="cardHolder" placeholder="Insira o nome impresso no cartão">
        </div>
      </div>

      <!-- Form Pix (apenas aviso) -->
      <div id="pixSection" class="hidden"
        style="text-align:center; padding: 20px; background: #f0fdf4; border: 1px dashed #16a34a; border-radius: 6px; color: #166534; font-size: 13px;">
        Ao finalizar a compra, um <strong>QR Code Pix</strong> será gerado. O pagamento é aprovado instantaneamente.
      </div>

    </form> <!-- /form-section -->

    <!-- Resumo -->
    <div class="summary-section">
      <div class="summary-title">Resumo</div>
      <div class="summary-row">
        <span>Código Passional</span>
        <span>R$ 0,01</span>
      </div>
      <div class="summary-row">
        <span>Subtotal</span>
        <span>R$ 0,01</span>
      </div>
      <div class="summary-row total">
        <span>Total</span>
        <span>1x R$ 0,01</span>
      </div>

      <button type="button" class="btn-submit" id="btnSubmit" onclick="handleSubmit()">
        Comprar agora
      </button>

      <div class="secure-footer">
        <div class="secure-icon">
          <svg width="12" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
          </svg>
          Ambiente seguro
        </div>
        <div style="font-size:10px;">Seus dados confidenciais</div>

        <p class="legal-text">
          Ao clicar em "Comprar agora", declaro que apenas intermedio o pagamento, não sendo responsável pelo conteúdo
          ou oferta do infoproduto. Concordo com os Termos de Compra e Política de Privacidade.
        </p>
        <div style="margin-top:8px; font-size:10px; color:#cbd5e1;">COPYRIGHT © 2026 | Todos os direitos reservados
        </div>
      </div>
    </div>

  </div> <!-- /container -->

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    let currentTab = 'card';

    // Máscaras
    IMask(document.getElementById('cpf'), { mask: [{ mask: '000.000.000-00' }, { mask: '00.000.000/0000-00' }] });
    IMask(document.getElementById('phone'), { mask: '(00) 00000-0000' });
    IMask(document.getElementById('cardNumber'), { mask: '0000 0000 0000 0000' });
    IMask(document.getElementById('cardExpiry'), { mask: 'MM/YY', blocks: { MM: { mask: IMask.MaskedRange, from: 1, to: 12 }, YY: { mask: IMask.MaskedRange, from: 0, to: 99 } } });
    IMask(document.getElementById('cardCvv'), { mask: '0000' });

    function setTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      event.currentTarget.classList.add('active'); // O elemento clicado ganha a classe active

      if (tab === 'card') {
        document.getElementById('cardSection').classList.remove('hidden');
        document.getElementById('pixSection').classList.add('hidden');
      } else {
        document.getElementById('cardSection').classList.add('hidden');
        document.getElementById('pixSection').classList.remove('hidden');
      }
    }

    // Validações simples
    function validateEmail() {
      const e1 = document.getElementById('email').value;
      const e2 = document.getElementById('emailConf').value;
      if (e1 !== e2) { alert('Os e-mails não conferem.'); return false; }
      return true;
    }

    async function handleSubmit() {
      const btn = document.getElementById('btnSubmit');

      // Validaçoes básicas (Nome removido)
      const email = document.getElementById('email').value;
      const cpf = document.getElementById('cpf').value;
      const phone = document.getElementById('phone').value;

      if (!email || !cpf || !phone) { alert('Preencha seus dados de contato'); return; }

      // Monta payload
      const body = {
        email, cpf, phone,
        billingType: currentTab === 'card' ? 'CREDIT_CARD' : 'PIX',
        installments: 1
      };

      if (currentTab === 'card') {
        const number = document.getElementById('cardNumber').value;
        const expiry = document.getElementById('cardExpiry').value;
        const cvv = document.getElementById('cardCvv').value;
        const holderName = document.getElementById('cardHolder').value;

        if (!number || !expiry || !cvv || !holderName) { alert('Preencha os dados do cartão'); return; }
        body.card = { number, expiry, cvv, holderName };
      }

      // Feedback visual
      const originalText = btn.textContent;
      btn.textContent = 'Processando...';
      btn.disabled = true;

      // Pixel: InitiateCheckout
      if (typeof fbq === 'function') {
        fbq('track', 'InitiateCheckout', {
          value: 0.01,
          currency: 'BRL',
          content_ids: ['codigo-passional'],
          content_type: 'product'
        });
      }

      try {
        const res = await axios.post('/api/checkout', body);
        const data = res.data;

        if (data.success) {
          // Salva sessão
          const sessionData = {
            paymentId: data.paymentId,
            billingType: data.billingType || (currentTab === 'card' ? 'CREDIT_CARD' : 'PIX'), // Fallback
            value: 0.01,
            name: body.name,
            email: body.email,
            installments: 1
          };

          if (currentTab === 'pix' && data.qrCode) {
            sessionData.qrCode = data.qrCode;
            sessionData.pixPayload = data.pixPayload;
            sessionData.expirationDate = data.expirationDate;
            sessionStorage.setItem('pix_data', JSON.stringify(sessionData));
            window.location.href = '/pix.html';
          } else {
            sessionStorage.setItem('payment_data', JSON.stringify(sessionData));
            window.location.href = '/obrigado.html';
          }
        } else {
          alert('Erro: ' + (data.error || 'Erro desconhecido'));
        }

      } catch (err) {
        console.error(err);
        alert('Erro ao processar: ' + (err.response?.data?.error || err.message));
      } finally {
        btn.textContent = originalText;
        btn.disabled = false;
      }
    }
  </script>
</body>

</html>